<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Committee Optimizer - Johnston Student Council</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600;700&family=Work+Sans:wght@400;500;600&display=swap" rel="stylesheet">
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState } = React;

    // Lucide icons as inline SVG components
    const Upload = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
        <polyline points="17 8 12 3 7 8" />
        <line x1="12" y1="3" x2="12" y2="15" />
      </svg>
    );

    const Users = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
        <circle cx="9" cy="7" r="4" />
        <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
        <path d="M16 3.13a4 4 0 0 1 0 7.75" />
      </svg>
    );

    const TrendingUp = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18" />
        <polyline points="17 6 23 6 23 12" />
      </svg>
    );

    const Download = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
        <polyline points="7 10 12 15 17 10" />
        <line x1="12" y1="15" x2="12" y2="3" />
      </svg>
    );

    const CheckCircle = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" />
        <polyline points="22 4 12 14.01 9 11.01" />
      </svg>
    );

    const AlertCircle = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <circle cx="12" cy="12" r="10" />
        <line x1="12" y1="8" x2="12" y2="12" />
        <line x1="12" y1="16" x2="12.01" y2="16" />
      </svg>
    );

    const UserCheck = ({ size = 24, className = "" }) => (
      <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
        <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
        <circle cx="8.5" cy="7" r="4" />
        <polyline points="17 11 19 13 23 9" />
      </svg>
    );

    function CommitteeOptimizer() {
      const [preferencesData, setPreferencesData] = useState(null);
      const [rosterData, setRosterData] = useState(null);
      const [assignments, setAssignments] = useState(null);
      const [stats, setStats] = useState(null);
      const [unassignedEmails, setUnassignedEmails] = useState([]);
      const [duplicateSubmissions, setDuplicateSubmissions] = useState([]);
      const [numCommittees, setNumCommittees] = useState(7);
      const [isProcessing, setIsProcessing] = useState(false);

      const parsePreferencesCSV = (text) => {
        const lines = text.split('\n').filter(line => line.trim());
        
        const data = lines.slice(1).map(line => {
          const values = line.split(',').map(v => v.trim());
          return {
            email: values[1] ? values[1].toLowerCase().trim() : '',
            first: values[2],
            second: values[3],
            third: values[4]
          };
        }).filter(row => row.email && row.first);

        // Detect duplicates
        const emailCounts = {};
        const duplicates = [];
        data.forEach(person => {
          emailCounts[person.email] = (emailCounts[person.email] || 0) + 1;
        });
        
        Object.entries(emailCounts).forEach(([email, count]) => {
          if (count > 1) {
            duplicates.push({ email, count });
          }
        });

        // Remove duplicates, keeping only the LAST submission
        const seen = new Set();
        const deduped = [];
        // Go through in reverse to keep last submission
        for (let i = data.length - 1; i >= 0; i--) {
          if (!seen.has(data[i].email)) {
            deduped.unshift(data[i]);
            seen.add(data[i].email);
          }
        }

        return { data: deduped, duplicates };
      };

      const parseRosterCSV = (text) => {
        const lines = text.split('\n').filter(line => line.trim());
        
        const data = lines.slice(1).map(line => {
          const values = line.split(',').map(v => v.trim());
          return {
            email: values[0] ? values[0].toLowerCase().trim() : '',
            isLeader: values[1] && values[1].toLowerCase() === 'yes'
          };
        }).filter(row => row.email);

        return data;
      };

      const handlePreferencesUpload = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const text = e.target.result;
          const parsed = parsePreferencesCSV(text);
          setPreferencesData(parsed.data);
          setDuplicateSubmissions(parsed.duplicates);
          setAssignments(null);
          setStats(null);
          setUnassignedEmails([]);
        };
        reader.readAsText(file);
      };

      const handleRosterUpload = (event) => {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = (e) => {
          const text = e.target.result;
          const parsed = parseRosterCSV(text);
          setRosterData(parsed);
          setAssignments(null);
          setStats(null);
          setUnassignedEmails([]);
        };
        reader.readAsText(file);
      };

      const optimizeAssignments = () => {
        if (!preferencesData || !rosterData) return;
        
        setIsProcessing(true);
        
        setTimeout(() => {
          console.log('=== DEBUG INFO ===');
          console.log('Total roster:', rosterData.length);
          console.log('Total preferences:', preferencesData.length);
          if (duplicateSubmissions.length > 0) {
            console.log('Duplicate submissions:', duplicateSubmissions.length);
            console.log('Duplicate emails:', duplicateSubmissions.map(d => `${d.email} (${d.count}x)`));
          }
          
          const committeesSet = new Set();
          preferencesData.forEach(person => {
            if (person.first) committeesSet.add(person.first);
            if (person.second) committeesSet.add(person.second);
            if (person.third) committeesSet.add(person.third);
          });

          const committees = Array.from(committeesSet).slice(0, numCommittees);
          
          const leaders = rosterData.filter(p => p.isLeader);
          const nonLeaders = rosterData.filter(p => !p.isLeader);
          
          const preferencesEmails = new Set(preferencesData.map(p => p.email));
          
          const leadersWithPrefs = leaders.filter(l => preferencesEmails.has(l.email));
          const leadersWithoutPrefs = leaders.filter(l => !preferencesEmails.has(l.email));
          const nonLeadersWithPrefs = nonLeaders.filter(nl => preferencesEmails.has(nl.email));
          const nonLeadersWithoutPrefs = nonLeaders.filter(nl => !preferencesEmails.has(nl.email));

          console.log('Leaders with prefs:', leadersWithPrefs.length);
          console.log('Leaders without prefs:', leadersWithoutPrefs.length);
          console.log('Non-leaders with prefs:', nonLeadersWithPrefs.length);
          console.log('Non-leaders without prefs:', nonLeadersWithoutPrefs.length);
          console.log('Expected total:', leadersWithPrefs.length + leadersWithoutPrefs.length + nonLeadersWithPrefs.length + nonLeadersWithoutPrefs.length);

          const preferencesMap = {};
          preferencesData.forEach(p => {
            preferencesMap[p.email] = p;
          });

          const committeeMembers = {};
          committees.forEach(c => committeeMembers[c] = []);
          
          const result = [];
          const targetSize = Math.floor(rosterData.length / committees.length);
          const maxSize = targetSize + 1;

          const shuffledLeaders = [...leadersWithPrefs].sort(() => Math.random() - 0.5);
          
          for (let i = 0; i < Math.min(committees.length, shuffledLeaders.length); i++) {
            const leader = shuffledLeaders[i];
            const prefs = preferencesMap[leader.email];
            const committee = committees[i];
            
            committeeMembers[committee].push({
              email: leader.email,
              isLeader: true
            });
            
            result.push({
              email: leader.email,
              assigned: committee,
              preference: prefs.first === committee ? 1 : prefs.second === committee ? 2 : prefs.third === committee ? 3 : 4,
              isLeader: true
            });
          }

          // Assign remaining leaders who have preferences but weren't assigned yet
          const assignedLeaders = new Set(result.map(r => r.email));
          console.log('Leaders assigned in first pass:', assignedLeaders.size);
          console.log('Remaining leaders with prefs:', leadersWithPrefs.length - assignedLeaders.size);
          
          leadersWithPrefs.forEach(leader => {
            if (!assignedLeaders.has(leader.email)) {
              const prefs = preferencesMap[leader.email];
              
              // Try to assign to their first choice if it has room
              let assigned = false;
              for (let prefLevel = 1; prefLevel <= 3 && !assigned; prefLevel++) {
                const choice = prefLevel === 1 ? prefs.first : prefLevel === 2 ? prefs.second : prefs.third;
                if (choice && committees.includes(choice) && committeeMembers[choice].length < maxSize) {
                  committeeMembers[choice].push({
                    email: leader.email,
                    isLeader: true
                  });
                  
                  result.push({
                    email: leader.email,
                    assigned: choice,
                    preference: prefLevel,
                    isLeader: true
                  });
                  
                  assignedLeaders.add(leader.email);
                  assigned = true;
                }
              }
              
              // If none of their top 3 had room, assign to smallest committee
              if (!assigned) {
                const smallestCommittee = committees.reduce((min, c) => 
                  committeeMembers[c].length < committeeMembers[min].length ? c : min
                );
                
                committeeMembers[smallestCommittee].push({
                  email: leader.email,
                  isLeader: true
                });
                
                result.push({
                  email: leader.email,
                  assigned: smallestCommittee,
                  preference: 4,
                  isLeader: true
                });
                
                assignedLeaders.add(leader.email);
              }
            }
          });

          // Now assign leaders who didn't fill out the form
          leadersWithoutPrefs.forEach(leader => {
            if (!assignedLeaders.has(leader.email)) {
              const smallestCommittee = committees.reduce((min, c) => 
                committeeMembers[c].length < committeeMembers[min].length ? c : min
              );
              
              committeeMembers[smallestCommittee].push({
                email: leader.email,
                isLeader: true
              });
              
              result.push({
                email: leader.email,
                assigned: smallestCommittee,
                preference: 5,
                isLeader: true
              });
              
              assignedLeaders.add(leader.email);
            }
          });

          const assigned = new Set(result.map(r => r.email));
          
          const firstChoiceCounts = {};
          nonLeadersWithPrefs.forEach(person => {
            const prefs = preferencesMap[person.email];
            if (prefs && prefs.first) {
              firstChoiceCounts[prefs.first] = (firstChoiceCounts[prefs.first] || 0) + 1;
            }
          });

          const sortedNonLeaders = [...nonLeadersWithPrefs].sort((a, b) => {
            const prefsA = preferencesMap[a.email];
            const prefsB = preferencesMap[b.email];
            return (firstChoiceCounts[prefsA.first] || 0) - (firstChoiceCounts[prefsB.first] || 0);
          });

          for (let prefLevel = 1; prefLevel <= 3; prefLevel++) {
            sortedNonLeaders.forEach(person => {
              if (assigned.has(person.email)) return;
              
              const prefs = preferencesMap[person.email];
              const choice = prefLevel === 1 ? prefs.first : prefLevel === 2 ? prefs.second : prefs.third;
              
              if (choice && committees.includes(choice) && committeeMembers[choice].length < maxSize) {
                committeeMembers[choice].push({
                  email: person.email,
                  isLeader: false
                });
                
                result.push({
                  email: person.email,
                  assigned: choice,
                  preference: prefLevel,
                  isLeader: false
                });
                
                assigned.add(person.email);
              }
            });
          }

          sortedNonLeaders.forEach(person => {
            if (assigned.has(person.email)) return;
            
            const smallestCommittee = committees.reduce((min, c) => 
              committeeMembers[c].length < committeeMembers[min].length ? c : min
            );
            
            committeeMembers[smallestCommittee].push({
              email: person.email,
              isLeader: false
            });
            
            result.push({
              email: person.email,
              assigned: smallestCommittee,
              preference: 4,
              isLeader: false
            });
            
            assigned.add(person.email);
          });

          const shuffledWithoutPrefs = [...nonLeadersWithoutPrefs].sort(() => Math.random() - 0.5);
          
          shuffledWithoutPrefs.forEach(person => {
            const smallestCommittee = committees.reduce((min, c) => 
              committeeMembers[c].length < committeeMembers[min].length ? c : min
            );
            
            committeeMembers[smallestCommittee].push({
              email: person.email,
              isLeader: false
            });
            
            result.push({
              email: person.email,
              assigned: smallestCommittee,
              preference: 5,
              isLeader: false
            });
          });

          const first = result.filter(r => r.preference === 1).length;
          const second = result.filter(r => r.preference === 2).length;
          const third = result.filter(r => r.preference === 3).length;
          const none = result.filter(r => r.preference === 4).length;
          const noForm = result.filter(r => r.preference === 5).length;

          console.log('=== ASSIGNMENT RESULTS ===');
          console.log('Total assigned:', result.length);
          console.log('First choice:', first);
          console.log('Second choice:', second);
          console.log('Third choice:', third);
          console.log('None of top 3:', none);
          console.log('No form filled:', noForm);
          
          // Find unassigned people
          const assignedEmails = new Set(result.map(r => r.email));
          const unassigned = rosterData.filter(p => !assignedEmails.has(p.email));
          if (unassigned.length > 0) {
            console.log('=== UNASSIGNED PEOPLE ===');
            console.log('Count:', unassigned.length);
            console.log('Emails:', unassigned.map(p => p.email));
          }
          console.log('======================');

          const statistics = {
            first: ((first / result.length) * 100).toFixed(1),
            second: ((second / result.length) * 100).toFixed(1),
            third: ((third / result.length) * 100).toFixed(1),
            none: ((none / result.length) * 100).toFixed(1),
            noForm: ((noForm / result.length) * 100).toFixed(1),
            top3: (((first + second + third) / result.length) * 100).toFixed(1),
            committees: Object.entries(committeeMembers).map(([name, members]) => ({
              name,
              size: members.length,
              leaders: members.filter(m => m.isLeader).length
            })).sort((a, b) => b.size - a.size),
            totalFilled: preferencesData.length,
            totalRoster: rosterData.length,
            totalAssigned: result.length,
            notFilled: noForm
          };

          setUnassignedEmails(unassigned.map(p => p.email));
          setAssignments(result);
          setStats(statistics);
          setIsProcessing(false);
        }, 100);
      };

      const downloadResults = () => {
        if (!assignments) return;

        const csv = [
          'Email,Assigned Committee,Is Leader,Preference (1=1st Choice, 2=2nd, 3=3rd, 4=None, 5=No Form)',
          ...assignments.map(a => `${a.email},${a.assigned},${a.isLeader ? 'Yes' : 'No'},${a.preference}`)
        ].join('\n');

        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = 'committee-assignments.csv';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        URL.revokeObjectURL(url);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 p-8">
          <style>{`
            body {
              font-family: 'Work Sans', sans-serif;
            }
            
            h1, h2, h3 {
              font-family: 'Crimson Pro', serif;
            }

            .upload-zone {
              border: 2px dashed #d97706;
              transition: all 0.3s ease;
            }

            .upload-zone:hover {
              border-color: #ea580c;
              background: rgba(234, 88, 12, 0.05);
            }

            .stat-card {
              transition: transform 0.2s ease, box-shadow 0.2s ease;
            }

            .stat-card:hover {
              transform: translateY(-2px);
              box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
            }

            .committee-bar {
              animation: growWidth 0.6s ease-out forwards;
              transform-origin: left;
            }

            @keyframes growWidth {
              from { width: 0; }
            }

            @keyframes fadeInUp {
              from {
                opacity: 0;
                transform: translateY(20px);
              }
              to {
                opacity: 1;
                transform: translateY(0);
              }
            }

            .fade-in-up {
              animation: fadeInUp 0.5s ease-out forwards;
            }

            .stagger-1 { animation-delay: 0.1s; opacity: 0; }
            .stagger-2 { animation-delay: 0.2s; opacity: 0; }
            .stagger-3 { animation-delay: 0.3s; opacity: 0; }
            .stagger-4 { animation-delay: 0.4s; opacity: 0; }
            .stagger-5 { animation-delay: 0.5s; opacity: 0; }
          `}</style>

          <div className="max-w-6xl mx-auto">
            <div className="text-center mb-12">
              <h1 className="text-6xl font-bold text-gray-900 mb-3">
                Committee Optimizer
              </h1>
              <p className="text-xl text-gray-600">
                Smart assignment tool for student council committees
              </p>
            </div>

            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
              <div className="bg-white rounded-2xl shadow-lg p-8">
                <div className="flex items-center gap-3 mb-6">
                  <Upload size={28} className="text-orange-600" />
                  <h2 className="text-2xl font-semibold text-gray-900">Preferences Form</h2>
                </div>
                
                <div className="upload-zone rounded-xl p-6 text-center bg-white">
                  <input
                    type="file"
                    accept=".csv"
                    onChange={handlePreferencesUpload}
                    className="hidden"
                    id="prefs-upload"
                  />
                  <label
                    htmlFor="prefs-upload"
                    className="cursor-pointer block"
                  >
                    <div className="flex flex-col items-center gap-3">
                      <Upload size={40} className="text-orange-600" />
                      <p className="text-base font-medium text-gray-700">
                        Upload Preferences CSV
                      </p>
                      <p className="text-xs text-gray-500">
                        Timestamp, Email, First Choice, Second Choice, Third Choice
                      </p>
                    </div>
                  </label>
                </div>

                {preferencesData && (
                  <>
                    <div className="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                      <div className="flex items-center gap-2 text-green-700 text-sm">
                        <CheckCircle size={18} />
                        <span className="font-medium">
                          {preferencesData.length} forms loaded
                        </span>
                      </div>
                    </div>
                    
                    {duplicateSubmissions.length > 0 && (
                      <div className="mt-3 p-3 bg-yellow-50 border border-yellow-300 rounded-lg">
                        <div className="flex items-center gap-2 text-yellow-700 text-sm mb-2">
                          <AlertCircle size={18} />
                          <span className="font-medium">
                            Warning: {duplicateSubmissions.length} people submitted the form multiple times
                          </span>
                        </div>
                        <div className="text-xs text-yellow-600 ml-6">
                          <p className="mb-1">Using their <strong>most recent</strong> submission:</p>
                          <div className="max-h-32 overflow-y-auto">
                            {duplicateSubmissions.map((dup, idx) => (
                              <div key={idx} className="font-mono">{dup.email} ({dup.count}x)</div>
                            ))}
                          </div>
                        </div>
                      </div>
                    )}
                  </>
                )}
              </div>

              <div className="bg-white rounded-2xl shadow-lg p-8">
                <div className="flex items-center gap-3 mb-6">
                  <UserCheck size={28} className="text-orange-600" />
                  <h2 className="text-2xl font-semibold text-gray-900">Full Roster</h2>
                </div>
                
                <div className="upload-zone rounded-xl p-6 text-center bg-white">
                  <input
                    type="file"
                    accept=".csv"
                    onChange={handleRosterUpload}
                    className="hidden"
                    id="roster-upload"
                  />
                  <label
                    htmlFor="roster-upload"
                    className="cursor-pointer block"
                  >
                    <div className="flex flex-col items-center gap-3">
                      <UserCheck size={40} className="text-orange-600" />
                      <p className="text-base font-medium text-gray-700">
                        Upload Full Roster CSV
                      </p>
                      <p className="text-xs text-gray-500">
                        Email, Is Leader (Yes/No)
                      </p>
                    </div>
                  </label>
                </div>

                {rosterData && (
                  <div className="mt-4 p-3 bg-green-50 border border-green-200 rounded-lg">
                    <div className="flex items-center gap-2 text-green-700 text-sm">
                      <CheckCircle size={18} />
                      <span className="font-medium">
                        {rosterData.length} council members loaded ({rosterData.filter(r => r.isLeader).length} leaders)
                      </span>
                    </div>
                  </div>
                )}
              </div>
            </div>

            {preferencesData && rosterData && !assignments && (
              <div className="bg-white rounded-2xl shadow-lg p-8 mb-8 fade-in-up">
                <div className="flex items-center gap-3 mb-6">
                  <Users size={28} className="text-orange-600" />
                  <h2 className="text-3xl font-semibold text-gray-900">Configure</h2>
                </div>

                {rosterData.length - preferencesData.length > 0 && (
                  <div className="mb-6 p-4 bg-yellow-50 border border-yellow-200 rounded-lg">
                    <div className="flex items-center gap-2 text-yellow-700">
                      <AlertCircle size={20} />
                      <span className="font-medium">
                        {rosterData.length - preferencesData.length} people didn't fill out the form - they'll be auto-assigned
                      </span>
                    </div>
                  </div>
                )}

                <div className="space-y-4">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      Number of Committees
                    </label>
                    <input
                      type="number"
                      min="1"
                      max="15"
                      value={numCommittees}
                      onChange={(e) => setNumCommittees(parseInt(e.target.value) || 7)}
                      className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
                    />
                    <p className="text-xs text-gray-500 mt-1">
                      Target: ~{Math.floor(rosterData.length / numCommittees)} people per committee
                    </p>
                  </div>

                  <button
                    onClick={optimizeAssignments}
                    disabled={isProcessing}
                    className="w-full bg-gradient-to-r from-orange-600 to-red-600 text-white py-4 rounded-lg font-semibold text-lg hover:from-orange-700 hover:to-red-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {isProcessing ? 'Optimizing...' : 'Optimize Assignments'}
                  </button>
                </div>
              </div>
            )}

            {assignments && stats && (
              <>
                <div className="bg-white rounded-2xl shadow-lg p-8 mb-8 fade-in-up">
                  <div className="flex items-center gap-3 mb-6">
                    <TrendingUp size={28} className="text-orange-600" />
                    <h2 className="text-3xl font-semibold text-gray-900">Results</h2>
                  </div>

                  <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div className="stat-card bg-gradient-to-br from-green-50 to-emerald-50 p-6 rounded-xl border border-green-200 stagger-1 fade-in-up">
                      <div className="text-3xl font-bold text-green-700 mb-1">{stats.totalFilled}</div>
                      <div className="text-sm font-medium text-green-600">Forms Filled</div>
                    </div>

                    <div className="stat-card bg-gradient-to-br from-yellow-50 to-amber-50 p-6 rounded-xl border border-yellow-200 stagger-2 fade-in-up">
                      <div className="text-3xl font-bold text-yellow-700 mb-1">{stats.notFilled}</div>
                      <div className="text-sm font-medium text-yellow-600">Auto-Assigned</div>
                    </div>

                    <div className="stat-card bg-gradient-to-br from-orange-50 to-red-50 p-6 rounded-xl border border-orange-200 stagger-3 fade-in-up">
                      <div className="text-3xl font-bold text-orange-700 mb-1">{stats.top3}%</div>
                      <div className="text-sm font-medium text-orange-600">Got Top 3 Choices</div>
                    </div>
                  </div>

                  {stats.totalAssigned !== stats.totalRoster && (
                    <div className="mb-6 p-4 bg-red-50 border border-red-200 rounded-lg">
                      <div className="flex items-center gap-2 text-red-700 mb-2">
                        <AlertCircle size={20} />
                        <span className="font-medium">
                          Warning: Assigned {stats.totalAssigned} people but roster has {stats.totalRoster}. 
                        </span>
                      </div>
                      {unassignedEmails.length > 0 && (
                        <div className="mt-3 text-sm text-red-600">
                          <p className="font-medium mb-1">Unassigned emails ({unassignedEmails.length}):</p>
                          <div className="max-h-40 overflow-y-auto bg-white p-2 rounded border border-red-200">
                            {unassignedEmails.map((email, idx) => (
                              <div key={idx} className="text-xs font-mono py-0.5">{email}</div>
                            ))}
                          </div>
                          <p className="mt-2 text-xs">These emails are in your roster but not in preferences. Check for typos or case differences.</p>
                        </div>
                      )}
                    </div>
                  )}

                  <div className="grid grid-cols-2 md:grid-cols-5 gap-4 mb-8">
                    <div className="stat-card bg-white p-4 rounded-xl border-2 border-green-200 stagger-1 fade-in-up">
                      <div className="text-2xl font-bold text-green-700 mb-1">{stats.first}%</div>
                      <div className="text-xs font-medium text-green-600">1st Choice</div>
                    </div>

                    <div className="stat-card bg-white p-4 rounded-xl border-2 border-blue-200 stagger-2 fade-in-up">
                      <div className="text-2xl font-bold text-blue-700 mb-1">{stats.second}%</div>
                      <div className="text-xs font-medium text-blue-600">2nd Choice</div>
                    </div>

                    <div className="stat-card bg-white p-4 rounded-xl border-2 border-purple-200 stagger-3 fade-in-up">
                      <div className="text-2xl font-bold text-purple-700 mb-1">{stats.third}%</div>
                      <div className="text-xs font-medium text-purple-600">3rd Choice</div>
                    </div>

                    <div className="stat-card bg-white p-4 rounded-xl border-2 border-gray-200 stagger-4 fade-in-up">
                      <div className="text-2xl font-bold text-gray-700 mb-1">{stats.none}%</div>
                      <div className="text-xs font-medium text-gray-600">None of 3</div>
                    </div>

                    <div className="stat-card bg-white p-4 rounded-xl border-2 border-yellow-200 stagger-5 fade-in-up">
                      <div className="text-2xl font-bold text-yellow-700 mb-1">{stats.noForm}%</div>
                      <div className="text-xs font-medium text-yellow-600">No Form</div>
                    </div>
                  </div>

                  <div className="space-y-3">
                    <h3 className="text-xl font-semibold text-gray-900 mb-4">Committee Distribution</h3>
                    {stats.committees.map((committee, idx) => (
                      <div key={committee.name} className="fade-in-up" style={{animationDelay: `${idx * 0.05}s`, opacity: 0}}>
                        <div className="flex items-center justify-between mb-2">
                          <span className="font-medium text-gray-700">{committee.name}</span>
                          <span className="text-sm text-gray-600">
                            {committee.size} total ({committee.leaders} leader{committee.leaders !== 1 ? 's' : ''})
                          </span>
                        </div>
                        <div className="w-full bg-gray-200 rounded-full h-2.5 overflow-hidden">
                          <div
                            className="committee-bar bg-gradient-to-r from-orange-500 to-red-500 h-2.5 rounded-full"
                            style={{
                              width: `${(committee.size / Math.max(...stats.committees.map(c => c.size))) * 100}%`
                            }}
                          />
                        </div>
                      </div>
                    ))}
                  </div>

                  <button
                    onClick={downloadResults}
                    className="mt-8 w-full bg-gray-900 text-white py-4 rounded-lg font-semibold text-lg hover:bg-gray-800 transition-all flex items-center justify-center gap-2"
                  >
                    <Download size={20} />
                    Download Assignments CSV
                  </button>
                </div>

                <button
                  onClick={() => {
                    setPreferencesData(null);
                    setRosterData(null);
                    setAssignments(null);
                    setStats(null);
                    setUnassignedEmails([]);
                    setDuplicateSubmissions([]);
                  }}
                  className="w-full bg-white text-gray-700 py-3 rounded-lg font-medium hover:bg-gray-50 transition-all border border-gray-300"
                >
                  Start New Assignment
                </button>
              </>
            )}

            <div className="mt-12 text-center text-sm text-gray-500">
              <p>Built for Johnston Student Council â€¢ Optimized for future councils</p>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<CommitteeOptimizer />, document.getElementById('root'));
  </script>
</body>
</html>
